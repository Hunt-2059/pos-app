import React, { useEffect, useState } from 'react'
import db from '../dexie/db'
export default function Cashier(){ const [inventory,setInventory]=useState([]); const [cart,setCart]=useState([]); useEffect(()=>{ db.inventory.toArray().then(setInventory) },[]); function addToCart(item){ setCart(c=>{ const ex=c.find(x=>x.sku===item.sku); if(ex) return c.map(x=>x.sku===item.sku?{...x,qty:x.qty+1}:x); return [...c,{...item,qty:1}] }) }
 async function checkout(){ const total=cart.reduce((s,i)=>s+(i.price*i.qty),0); await db.sales.add({ timestamp: Date.now(), items: cart, total }); for(const it of cart){ const row=await db.inventory.where('sku').equals(it.sku).first(); if(row) await db.inventory.update(row.id,{qty:Math.max(0,row.qty-it.qty)}) } if(window.electronAPI?.notifyDesktop) window.electronAPI.notifyDesktop({title:'Sale complete',body:`Total: $${total.toFixed(2)}`}); if(window.electronAPI?.writeBackup){ const inv=await db.inventory.toArray(); const sales=await db.sales.toArray(); const customers=await db.customers.toArray(); window.electronAPI.writeBackup({inventory:inv,sales,customers}) } setCart([]); db.inventory.toArray().then(setInventory) }
 return (<div className="grid grid-cols-3 gap-4"><div className="col-span-2"><h2 className="text-xl mb-2">Inventory</h2><div className="grid grid-cols-3 gap-3">{inventory.map(it=>(<div key={it.id} className="p-3 bg-white dark:bg-gray-800 rounded shadow"><div className="font-bold">{it.name}</div><div>SKU: {it.sku}</div><div>Price: ${it.price}</div><div>Stock: {it.qty}</div><button onClick={()=>addToCart(it)} className="mt-2 px-2 py-1 bg-blue-500 text-white rounded">Add</button></div>))}</div></div><div><h2 className="text-xl">Cart</h2><div className="bg-white dark:bg-gray-800 p-3 rounded shadow">{cart.map((c,i)=><div key={i} className="flex justify-between">{c.name} x{c.qty} <span>${(c.price*c.qty).toFixed(2)}</span></div>)}<div className="mt-3"><button onClick={checkout} className="px-3 py-1 bg-green-600 text-white rounded">Checkout</button></div></div></div></div>) }
